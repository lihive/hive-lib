"use strict";(()=>{function R(){return{pass:!0}}function W(e,t){return{tileId:e,to:t}}function J(e,t){return{from:e,to:t}}function V(e){return e.length%2?"b":"w"}function H(e){return"pass"in e&&e.pass}function T(e){return"tileId"in e&&"to"in e}function B(e){return"from"in e&&"to"in e}function X(e,t){if(d(e,t)>1)return!1;let r=k(e,t)[0],o=y(e,r,t),n=S(e);return o.length!==n.length}var G=class extends Error{constructor(t,r){super(`Tiles (${t.q},${t.r}) and (${r.q},${r.r}) are not adjacent.`)}},M=class extends Error{constructor(t){super(`${t} is not a valid direction.`)}},q=class extends Error{constructor(t){super(`No tile at (${t.q}, ${t.r})`)}};var I=Math.sqrt(3);function te(e,t){let r=(I/3*e.x-.3333333333333333*e.y)/t,o=2/3*e.y/t,n=-r-o,i=Math.round(r),a=Math.round(o),u=Math.round(n),s=Math.abs(i-r),x=Math.abs(a-o),l=Math.abs(u-n);return s>x&&s>l?i=-a-u:x>l&&(a=-i-u),{q:i,r:a}}function g(e){return`${e.q}${e.r}`}function oe(e,t){return Math.abs(e.q-t.q)<=1&&Math.abs(e.r-t.r)<=1}function v(e,t){return!e||!t?!1:e.q===t.q&&e.r===t.r}function re(e){return 2*e}function O(e,t){let{q:r,r:o}=e;return{x:t*(I*r+I/2*o),y:t*(3/2*o)}}function ne(e,t){let{x:r,y:o}=O(e,t);return`translate(${r} ${o})`}function ie(e){return I*e}function P(e,t){return e.findIndex(r=>v(t,r))!==-1}function p(e,t){let{q:r,r:o}=e;switch(t){case 0:return e;case 1:return{q:r+1,r:o-1};case 2:return{q:r+1,r:o};case 3:return{q:r,r:o+1};case 4:return{q:r-1,r:o+1};case 5:return{q:r-1,r:o};case 6:return{q:r,r:o-1};default:throw new M(t)}}function ae(e,t){let r=t.q-e.q,o=t.r-e.r;if(r===-1){if(o===0)return 5;if(o===1)return 4}if(r===0){if(o===-1)return 6;if(o===1)return 3}if(r===1){if(o===-1)return 1;if(o===0)return 2}throw new G(e,t)}function N(e){for(;e<1;)e+=6;return 1+(e-1)%6}function se(e,t){return`${e}${t}`}function m(e){return e[1]}function f(e){return e[0]}function ce(e,t){return f(e)===t}function me(e,t,r){let o=0,n=`${t}Q`;return F(e,n).forEach(a=>{c(e,a).forEach(u=>{u===n&&(o+=1)})}),o===r.tileset.Q}function Ce(e,t){return F(e,`${t}Q`).every(o=>Q(e,o,(n,i)=>i.length>0))}function he(e,t,r){let o=d(e,t);return o?b(n=>{let i=p(t,n),a=c(e,i);return a.length>=o&&!$(e,t,n)?r(i,a,n):!0}):!0}function b(e){for(let t=1;t<=6;++t)if(e(t)==!1)return!1;return!0}function ge(e,t,r){let o=d(e,t);return o?b(n=>{let i=p(t,n),a=c(e,i);return o-a.length>=2&&!$(e,t,n)?r(i,a,n):!0}):!0}function C(e,t,r){return b(o=>{let n=p(t,o);return r(n,c(e,n),o)!==!1})}function E(e,t,r){return b(o=>{let n=p(t,o),i=c(e,n);return i.length?r(n,i)!==!1:!0})}function He(e,t,r){let o=c(e,t),n=k(e,t),i=a=>P(n,a);return o?C(e,t,(a,u,s)=>o.length-u.length===1&&!$(e,t,s)&&(o.length>1||j(e,a,i))?r(a,u,s):!0):!0}function h(e,t){for(let r in e)for(let o in e[r]){let n=e[r][o];if(t({q:+r,r:+o},n)===!1)return!1}return!0}function Te(e,t){let r=new Set;return h(e,o=>C(e,o,(n,i)=>{let a=g(n);return!r.has(a)&&!i.length?(r.add(a),t(n,i)!==!1):!0}))}function Q(e,t,r){return C(e,t,(o,n)=>r(o,n)===!0)}function Be(e,t,r){let o;return C(e,t,(n,i)=>r(n,i)?(o=n,!1):!0),o}function F(e,t){let r=[];return h(e,(o,n)=>{n.includes(t)&&r.push(o)}),r}function Ge(e,t){let r={};return t=t??e.length,e.slice(0,t).forEach(o=>{H(o)||(T(o)&&D(r,o.tileId,o.to),B(o)&&A(r,o.from,o.to))}),r}function Me(e,t,r){let o=0;return h(e,(n,i)=>{!t&&!r?o+=i.length:i.forEach(a=>{let u=t!==void 0?f(a)===t:!0,s=r!==void 0?m(a)===r:!0;u&&s&&(o+=1)})}),o}function S(e){let t=[];return h(e,r=>t.push(r)),t}function k(e,t){let r=[];return E(e,t,o=>{r.push(o)}),r}function c(e,t){let{q:r,r:o}=t,n=e[r];return n?n[o]??[]:[]}function d(e,t){return c(e,t).length}function qe(e,t){return c(e,t).pop()}function Ie(e){let t=[];return h(e,(r,o)=>t.push(...o)),t}function ve(e){let t=[];return h(e,(r,o)=>t.push(...o)),t}function be(e){let t=new Set,r=[];return S(e).forEach(o=>{C(e,o,(n,i)=>{let a=g(n);!i.length&&!t.has(a)&&(t.add(a),r.push(n))})}),r}function Se(e){return Object.keys(e).length===0}function $(e,t,r){let o=N(r-1),n=N(r+1),i=p(t,r),a=p(t,o),u=p(t,n),s=d(e,t),x=d(e,i),l=d(e,a),w=d(e,u);return s<=l&&s<=w&&x<l&&x<w}function ke(e,t){return c(e,t).length>0}function A(e,t,r){D(e,_(e,t),r)}function D(e,t,r){let{q:o,r:n}=r;o in e||(e[o]={}),n in e[o]||(e[o][n]=[]),e[o][n].push(t)}function _(e,t){let{q:r,r:o}=t,n=e[r]?.[o]||[],i=n.pop();if(!i)throw new q(t);return n.length===0&&delete e[r][o],Object.keys(e[r]).length===0&&delete e[r],i}function j(e,t,r){return!C(e,t,(o,n,i)=>!r(o,n,i))}function y(e,t,r){let o=new Set,n=[],i=u=>{o.add(g(u)),n.push(u),E(e,u,s=>{!v(r,s)&&!o.has(g(s))&&i(s)})};return c(e,t).length&&!v(t,r)&&i(t),n}var $e={tileset:{A:3,B:2,G:3,S:2,Q:1}};function Pe(e,t){return m(e)==="L"&&(t?f(e)===t:!0)}function De(e,t){return m(e)==="M"&&(t?f(e)===t:!0)}function Ae(e){return e.map(t=>H(t)?L():T(t)?U(t.tileId,t.to):B(t)?K(t.from,t.to):"").join()}function K(e,t){return`(${e.q},${e.r})(${t.q},${t.r})`}function L(){return"x"}function U(e,t){return`(${t.q},${t.r})[${e}]`}function _e(e){function t(a){if(a[0]==="("){let u=a.slice(1,-1).split(",");return{q:parseInt(u[0]),r:parseInt(u[1])}}if(a[0]==="[")return a.slice(1,-1);throw new Error(`Invalid token: ${a}`)}let r=[],o=[],n="",i="";for(let a=0,u=e.length;a<u;++a){let s=e[a];if(s==="#")break;if(s==="x"){r.push({pass:!0});continue}if(n+=s,i+=s,(s===")"||s==="]")&&(o.push(i),i=""),o.length===2){let x=t(o[0]),l=t(o[1]);typeof l=="string"?r.push({tileId:l,to:x}):r.push({from:x,to:l}),o=[],n=""}}return r}function Le(e,t){return m(e)==="P"&&(t?f(e)===t:!0)}})();
