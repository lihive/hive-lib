"use strict";(()=>{function ie(){return{pass:!0}}function ae(e,t){return{tileId:e,to:t}}function se(e,t){return{from:e,to:t}}function ue(e){return e.length%2?"b":"w"}function T(e){return"pass"in e&&e.pass}function B(e){return"tileId"in e&&"to"in e}function I(e){return"from"in e&&"to"in e}function ce(e,t){if(m(e,t)>1)return!1;let o=y(e,t)[0],r=F(e,o,t),n=q(e);return r.length!==n.length}var b=class extends Error{constructor(t,o){super(`Tiles (${t.q},${t.r}) and (${o.q},${o.r}) are not adjacent.`)}},G=class extends Error{constructor(t){super(`${t} is not a valid direction.`)}},M=class extends Error{constructor(t){super(`No tile at (${t.q}, ${t.r})`)}};var f=Math.sqrt(3),N=Math.PI,fe={tileset:{A:3,B:2,G:3,S:2,Q:1}},xe={id:"pointy-top",f0:f,f1:f/2,f2:0,f3:3/2,b0:f/3,b1:-1/3,b2:0,b3:2/3,startAngle:30},me={id:"flat-top",f0:3/2,f1:0,f2:f/2,f3:f,b0:2/3,b1:0,b2:-1/3,b3:f/3,startAngle:0};function ge(e,t){let o=(f/3*e.x-.3333333333333333*e.y)/t,r=2/3*e.y/t,n=-o-r,i=Math.round(o),a=Math.round(r),s=Math.round(n),u=Math.abs(i-o),l=Math.abs(a-r),c=Math.abs(s-n);return u>l&&u>c?i=-a-s:l>c&&(a=-i-s),{q:i,r:a}}function H(e){return`${e.q}${e.r}`}function He(e,t){return Math.abs(e.q-t.q)<=1&&Math.abs(e.r-t.r)<=1}function v(e,t){return!e||!t?!1:e.q===t.q&&e.r===t.r}function Te(e){return 2*e}function R(e,t,o){let{q:r,r:n}=e,i=o;return{x:t*(i.f0*r+i.f1*n),y:t*(i.f2*r+i.f3*n)}}function Be(e,t,o){let{x:r,y:n}=R(e,t,o);return`translate(${r} ${n}) rotate(${o.startAngle})`}function Ie(e){return f*e}function O(e,t){return e.findIndex(o=>v(t,o))!==-1}function p(e,t){let{q:o,r}=e;switch(t){case 0:return e;case 1:return{q:o+1,r:r-1};case 2:return{q:o+1,r};case 3:return{q:o,r:r+1};case 4:return{q:o-1,r:r+1};case 5:return{q:o-1,r};case 6:return{q:o,r:r-1};default:throw new G(t)}}function be(e,t){let o=t.q-e.q,r=t.r-e.r;if(o===-1){if(r===0)return 5;if(r===1)return 4}if(o===0){if(r===-1)return 6;if(r===1)return 3}if(o===1){if(r===-1)return 1;if(r===0)return 2}throw new b(e,t)}function S(e){for(;e<1;)e+=6;return 1+(e-1)%6}function E(e,t){return`${e}${t}`}function C(e){return e[1]}function x(e){return e[0]}function Me(e,t){return x(e)===t}function $e(e,t,o){let r=0,n=`${t}Q`;return A(e,n).forEach(a=>{d(e,a).forEach(s=>{s===n&&(r+=1)})}),r===o.tileset.Q}function ke(e,t){return A(e,`${t}Q`).every(r=>L(e,r,(n,i)=>i.length>0))}function Fe(e,t,o){let r=m(e,t);return r?P(n=>{let i=p(t,n),a=d(e,i);return a.length>=r&&!$(e,t,n)?o(i,a,n):!0}):!0}function P(e){for(let t=1;t<=6;++t)if(e(t)==!1)return!1;return!0}function Ne(e,t,o){let r=m(e,t);return r?P(n=>{let i=p(t,n),a=d(e,i);return r-a.length>=2&&!$(e,t,n)?o(i,a,n):!0}):!0}function g(e,t,o){return P(r=>{let n=p(t,r);return o(n,d(e,n),r)!==!1})}function w(e,t,o){return P(r=>{let n=p(t,r),i=d(e,n);return i.length?o(n,i)!==!1:!0})}function Oe(e,t,o){let r=d(e,t),n=y(e,t),i=a=>O(n,a);return r?g(e,t,(a,s,u)=>r.length-s.length===1&&!$(e,t,u)&&(r.length>1||Y(e,a,i))?o(a,s,u):!0):!0}function h(e,t){for(let o in e)for(let r in e[o]){let n=e[o][r];if(t({q:+o,r:+r},n)===!1)return!1}return!0}function Ee(e,t){let o=new Set;return h(e,r=>g(e,r,(n,i)=>{let a=H(n);return!o.has(a)&&!i.length?(o.add(a),t(n,i)!==!1):!0}))}function L(e,t,o){return g(e,t,(r,n)=>o(r,n)===!0)}function we(e,t,o){let r;return g(e,t,(n,i)=>o(n,i)?(r=n,!1):!0),r}function A(e,t){let o=[];return h(e,(r,n)=>{n.includes(t)&&o.push(r)}),o}function Ae(e,t){let o={};return t=t??e.length,e.slice(0,t).forEach(r=>{T(r)||(B(r)&&Q(o,r.tileId,r.to),I(r)&&K(o,r.from,r.to))}),o}function De(e,t,o){let r=0;return h(e,(n,i)=>{!t&&!o?r+=i.length:i.forEach(a=>{let s=t!==void 0?x(a)===t:!0,u=o!==void 0?C(a)===o:!0;s&&u&&(r+=1)})}),r}function q(e){let t=[];return h(e,o=>t.push(o)),t}function y(e,t){let o=[];return w(e,t,r=>{o.push(r)}),o}function d(e,t){let{q:o,r}=t,n=e[o];return n?n[r]??[]:[]}function Qe(e,t){let o=[];return h(e,(r,n)=>o.push({coordinate:r,tiles:n})),t&&W(o),o}function m(e,t){return d(e,t).length}function _e(e,t){return d(e,t).pop()}function je(e){let t=[];return h(e,(o,r)=>t.push(...r)),t}function D(e){let t=[];return h(e,(o,r)=>t.push(...r)),t}function Re(e){let t=new Set,o=[];return q(e).forEach(r=>{g(e,r,(n,i)=>{let a=H(n);!i.length&&!t.has(a)&&(t.add(a),o.push(n))})}),o}function Le(e){return Object.keys(e).length===0}function $(e,t,o){let r=S(o-1),n=S(o+1),i=p(t,o),a=p(t,r),s=p(t,n),u=m(e,t),l=m(e,i),c=m(e,a),k=m(e,s);return u<=c&&u<=k&&l<c&&l<k}function Ke(e,t){return d(e,t).length>0}function K(e,t,o){Q(e,U(e,t),o)}function Q(e,t,o){let{q:r,r:n}=o;r in e||(e[r]={}),n in e[r]||(e[r][n]=[]),e[r][n].push(t)}function U(e,t){let{q:o,r}=t,n=e[o]?.[r]||[],i=n.pop();if(!i)throw new M(t);return n.length===0&&delete e[o][r],Object.keys(e[o]).length===0&&delete e[o],i}function W(e){return e.slice().sort((t,o)=>{let r=o.coordinate.r-t.coordinate.r;return r<0?1:r===0?t.tiles.length-o.tiles.length:-1})}function Y(e,t,o){return!g(e,t,(r,n,i)=>!o(r,n,i))}function F(e,t,o){let r=new Set,n=[],i=s=>{r.add(H(s)),n.push(s),w(e,s,u=>{!v(o,u)&&!r.has(H(u))&&i(u)})};return d(e,t).length&&!v(t,o)&&i(t),n}function ze(e,t,o){let n=z(e,t,o).reduce((i,a)=>(i[a]=i[a]??[],i[a].push(a),i),{});return Object.values(n)}function z(e,t,o){let r=[],n={};D(e).forEach(a=>{n[a]=(n[a]||0)+1});let i;for(i in o.tileset){let a=E(t,i),s=o.tileset[i]||0,u=n[a]||0,l=Math.max(0,s-u),c=Array.from({length:l},()=>a);r.push(...c)}return r}function Xe(e,t){return C(e)==="L"&&(t?x(e)===t:!0)}function tt(e,t){return C(e)==="M"&&(t?x(e)===t:!0)}function nt(e){return e.map(t=>T(t)?V():B(t)?X(t.tileId,t.to):I(t)?J(t.from,t.to):"").join()}function J(e,t){return`(${e.q},${e.r})(${t.q},${t.r})`}function V(){return"x"}function X(e,t){return`(${t.q},${t.r})[${e}]`}function it(e){function t(a){if(a[0]==="("){let s=a.slice(1,-1).split(",");return{q:parseInt(s[0]),r:parseInt(s[1])}}if(a[0]==="[")return a.slice(1,-1);throw new Error(`Invalid token: ${a}`)}let o=[],r=[],n="",i="";for(let a=0,s=e.length;a<s;++a){let u=e[a];if(u==="#")break;if(u==="x"){o.push({pass:!0});continue}if(n+=u,i+=u,(u===")"||u==="]")&&(r.push(i),i=""),r.length===2){let l=t(r[0]),c=t(r[1]);typeof c=="string"?o.push({tileId:c,to:l}):o.push({from:l,to:c}),r=[],n=""}}return o}function ut(e,t){return C(e)==="P"&&(t?x(e)===t:!0)}function dt(e,t,o){let r=[];for(let s=0;s<6;++s){let u=2*N*s/6;r.push({x:e*Math.cos(u),y:e*Math.sin(u)})}if(t===0)return[_(r[5],o),...r.map(s=>j(s,o))].join(" ");let n=te(r,t/2),i=oe(n);return re(i,o).join(" ")}function _(e,t){return`M${e.x.toFixed(t)} ${e.y.toFixed(t)}`}function j(e,t){return`L${e.x.toFixed(t)} ${e.y.toFixed(t)}`}function Z(e,t,o){return`Q ${e.x.toFixed(o)} ${e.y.toFixed(o)}, ${t.x.toFixed(o)} ${t.y.toFixed(o)}`}function ee(e,t){let o=e[0],r=e[1],n=r.x-o.x,i=r.y-o.y,a=Math.hypot(n,i);return[{x:o.x+t*n/a,y:o.y+t*i/a},{x:r.x-t*n/a,y:r.y-t*i/a}]}function te(e,t){let o=e.map((i,a)=>{let s=a===e.length-1?e[0]:e[a+1];return[i,...ee([i,s],t)]}),r=o[0];return[o[o.length-1],...o,r]}function oe(e){let t=null,o=[];return e.forEach(([r,n,i])=>{t&&o.push([t,r,n]),t=i}),o}function re(e,t){let o=[];return e.forEach(([r,n,i],a)=>{a===0?o.push(_(r,t)):o.push(j(r,t)),o.push(Z(n,i,t))}),o}})();
