"use strict";(()=>{var M=class extends Error{constructor(t,r){super(`Tiles (${t.q},${t.r}) and (${r.q},${r.r}) are not adjacent.`)}},B=class extends Error{constructor(t){super(`Expected there to be a tile located at (${t.q}, ${t.r})`)}},O=class extends Error{constructor(t){super(`${t} is not a valid direction.`)}},w=class extends Error{constructor(t){super(`No tile at (${t.q}, ${t.r})`)}};var m=Math.sqrt(3),ue=Math.PI,ot={tileset:{A:3,B:2,G:3,S:2,Q:1}},it={id:"pointy-top",f0:m,f1:m/2,f2:0,f3:3/2,b0:m/3,b1:-1/3,b2:0,b3:2/3,startAngle:30},st={id:"flat-top",f0:3/2,f1:0,f2:m/2,f3:m,b0:2/3,b1:0,b2:-1/3,b3:m/3,startAngle:0};function ft(e,t){let r=(m/3*e.x-.3333333333333333*e.y)/t,n=2/3*e.y/t,o=-r-n,i=Math.round(r),s=Math.round(n),a=Math.round(o),c=Math.abs(i-r),u=Math.abs(s-n),f=Math.abs(a-o);return c>u&&c>f?i=-s-a:u>f&&(s=-i-a),{q:i,r:s}}function x(e){return`${e.q}${e.r}`}function lt(e,t){return Math.abs(e.q-t.q)<=1&&Math.abs(e.r-t.r)<=1}function G(e,t){return!e||!t?!1:e.q===t.q&&e.r===t.r}function dt(e){return 2*e}function Fe(e,t,r){let{q:n,r:o}=e,i=r;return{x:t*(i.f0*n+i.f1*o),y:t*(i.f2*n+i.f3*o)}}function pt(e,t,r){let{x:n,y:o}=Fe(e,t,r);return`translate(${n} ${o}) rotate(${r.startAngle})`}function ht(e){return m*e}function fe(e,t){return e.findIndex(r=>G(t,r))!==-1}function _(e,t){let{q:r,r:n}=e;switch(t){case 0:return e;case 1:return{q:r+1,r:n-1};case 2:return{q:r+1,r:n};case 3:return{q:r,r:n+1};case 4:return{q:r-1,r:n+1};case 5:return{q:r-1,r:n};case 6:return{q:r,r:n-1};default:throw new O(t)}}function mt(e,t){let r=t.q-e.q,n=t.r-e.r;if(r===-1){if(n===0)return 5;if(n===1)return 4}if(r===0){if(n===-1)return 6;if(n===1)return 3}if(r===1){if(n===-1)return 1;if(n===0)return 2}throw new M(e,t)}function j(e){for(;e<1;)e+=6;return 1+(e-1)%6}function gt(){return{pass:!0}}function yt(e,t){return{tileId:e,to:t}}function Ct(e,t){return{from:e,to:t}}function Ht(e){return e.length%2?"b":"w"}function E(e){return"pass"in e&&e.pass}function F(e){return"tileId"in e&&"to"in e}function N(e){return"from"in e&&"to"in e}function bt(e,t){if(g(e,t)>1)return!1;let r=W(e,t)[0],n=le(e,r,t),o=K(e);return n.length!==o.length}function de(e,t){return`${e}${t}`}function pe(e){return e[1]}function V(e){return e[0]}function Tt(e,t){return V(e)===t}var ye=Symbol.for("immer-nothing"),he=Symbol.for("immer-draftable"),l=Symbol.for("immer-state");function p(e,...t){throw new Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var v=Object.getPrototypeOf;function T(e){return!!e&&!!e[l]}function C(e){return e?Ce(e)||Array.isArray(e)||!!e[he]||!!e.constructor?.[he]||$(e)||q(e):!1}var Ne=Object.prototype.constructor.toString();function Ce(e){if(!e||typeof e!="object")return!1;let t=v(e);if(t===null)return!0;let r=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return r===Object?!0:typeof r=="function"&&Function.toString.call(r)===Ne}function D(e,t){z(e)===0?Reflect.ownKeys(e).forEach(r=>{t(r,e[r],e)}):e.forEach((r,n)=>t(n,r,e))}function z(e){let t=e[l];return t?t.type_:Array.isArray(e)?1:$(e)?2:q(e)?3:0}function X(e,t){return z(e)===2?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function He(e,t,r){let n=z(e);n===2?e.set(t,r):n===3?e.add(r):e[t]=r}function De(e,t){return e===t?e!==0||1/e===1/t:e!==e&&t!==t}function $(e){return e instanceof Map}function q(e){return e instanceof Set}function y(e){return e.copy_||e.base_}function Y(e,t){if($(e))return new Map(e);if(q(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);if(!t&&Ce(e))return v(e)?{...e}:Object.assign(Object.create(null),e);let r=Object.getOwnPropertyDescriptors(e);delete r[l];let n=Reflect.ownKeys(r);for(let o=0;o<n.length;o++){let i=n[o],s=r[i];s.writable===!1&&(s.writable=!0,s.configurable=!0),(s.get||s.set)&&(r[i]={configurable:!0,writable:!0,enumerable:s.enumerable,value:e[i]})}return Object.create(v(e),r)}function ne(e,t=!1){return R(e)||T(e)||!C(e)||(z(e)>1&&(e.set=e.add=e.clear=e.delete=ke),Object.freeze(e),t&&Object.entries(e).forEach(([r,n])=>ne(n,!0))),e}function ke(){p(2)}function R(e){return Object.isFrozen(e)}var Ae={};function H(e){let t=Ae[e];return t||p(0,e),t}var S;function be(){return S}function ze(e,t){return{drafts_:[],parent_:e,immer_:t,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function me(e,t){t&&(H("Patches"),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function Z(e){ee(e),e.drafts_.forEach($e),e.drafts_=null}function ee(e){e===S&&(S=e.parent_)}function xe(e){return S=ze(S,e)}function $e(e){let t=e[l];t.type_===0||t.type_===1?t.revoke_():t.revoked_=!0}function _e(e,t){t.unfinalizedDrafts_=t.drafts_.length;let r=t.drafts_[0];return e!==void 0&&e!==r?(r[l].modified_&&(Z(t),p(4)),C(e)&&(e=k(t,e),t.parent_||A(t,e)),t.patches_&&H("Patches").generateReplacementPatches_(r[l].base_,e,t.patches_,t.inversePatches_)):e=k(t,r,[]),Z(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==ye?e:void 0}function k(e,t,r){if(R(t))return t;let n=t[l];if(!n)return D(t,(o,i)=>ge(e,n,t,o,i,r)),t;if(n.scope_!==e)return t;if(!n.modified_)return A(e,n.base_,!0),n.base_;if(!n.finalized_){n.finalized_=!0,n.scope_.unfinalizedDrafts_--;let o=n.copy_,i=o,s=!1;n.type_===3&&(i=new Set(o),o.clear(),s=!0),D(i,(a,c)=>ge(e,n,o,a,c,r,s)),A(e,o,!1),r&&e.patches_&&H("Patches").generatePatches_(n,r,e.patches_,e.inversePatches_)}return n.copy_}function ge(e,t,r,n,o,i,s){if(T(o)){let a=i&&t&&t.type_!==3&&!X(t.assigned_,n)?i.concat(n):void 0,c=k(e,o,a);if(He(r,n,c),T(c))e.canAutoFreeze_=!1;else return}else s&&r.add(o);if(C(o)&&!R(o)){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1)return;k(e,o),(!t||!t.scope_.parent_)&&typeof n!="symbol"&&Object.prototype.propertyIsEnumerable.call(r,n)&&A(e,o)}}function A(e,t,r=!1){!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&ne(t,r)}function qe(e,t){let r=Array.isArray(e),n={type_:r?1:0,scope_:t?t.scope_:be(),modified_:!1,finalized_:!1,assigned_:{},parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1},o=n,i=oe;r&&(o=[n],i=I);let{revoke:s,proxy:a}=Proxy.revocable(o,i);return n.draft_=a,n.revoke_=s,a}var oe={get(e,t){if(t===l)return e;let r=y(e);if(!X(r,t))return Re(e,r,t);let n=r[t];return e.finalized_||!C(n)?n:n===J(e.base_,t)?(L(e),e.copy_[t]=re(n,e)):n},has(e,t){return t in y(e)},ownKeys(e){return Reflect.ownKeys(y(e))},set(e,t,r){let n=ve(y(e),t);if(n?.set)return n.set.call(e.draft_,r),!0;if(!e.modified_){let o=J(y(e),t),i=o?.[l];if(i&&i.base_===r)return e.copy_[t]=r,e.assigned_[t]=!1,!0;if(De(r,o)&&(r!==void 0||X(e.base_,t)))return!0;L(e),te(e)}return e.copy_[t]===r&&(r!==void 0||t in e.copy_)||Number.isNaN(r)&&Number.isNaN(e.copy_[t])||(e.copy_[t]=r,e.assigned_[t]=!0),!0},deleteProperty(e,t){return J(e.base_,t)!==void 0||t in e.base_?(e.assigned_[t]=!1,L(e),te(e)):delete e.assigned_[t],e.copy_&&delete e.copy_[t],!0},getOwnPropertyDescriptor(e,t){let r=y(e),n=Reflect.getOwnPropertyDescriptor(r,t);return n&&{writable:!0,configurable:e.type_!==1||t!=="length",enumerable:n.enumerable,value:r[t]}},defineProperty(){p(11)},getPrototypeOf(e){return v(e.base_)},setPrototypeOf(){p(12)}},I={};D(oe,(e,t)=>{I[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}});I.deleteProperty=function(e,t){return I.set.call(this,e,t,void 0)};I.set=function(e,t,r){return oe.set.call(this,e[0],t,r,e[0])};function J(e,t){let r=e[l];return(r?y(r):e)[t]}function Re(e,t,r){let n=ve(t,r);return n?"value"in n?n.value:n.get?.call(e.draft_):void 0}function ve(e,t){if(!(t in e))return;let r=v(e);for(;r;){let n=Object.getOwnPropertyDescriptor(r,t);if(n)return n;r=v(r)}}function te(e){e.modified_||(e.modified_=!0,e.parent_&&te(e.parent_))}function L(e){e.copy_||(e.copy_=Y(e.base_,e.scope_.immer_.useStrictShallowCopy_))}var Qe=class{constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(t,r,n)=>{if(typeof t=="function"&&typeof r!="function"){let i=r;r=t;let s=this;return function(c=i,...u){return s.produce(c,f=>r.call(this,f,...u))}}typeof r!="function"&&p(6),n!==void 0&&typeof n!="function"&&p(7);let o;if(C(t)){let i=xe(this),s=re(t,void 0),a=!0;try{o=r(s),a=!1}finally{a?Z(i):ee(i)}return me(i,n),_e(o,i)}else if(!t||typeof t!="object"){if(o=r(t),o===void 0&&(o=t),o===ye&&(o=void 0),this.autoFreeze_&&ne(o,!0),n){let i=[],s=[];H("Patches").generateReplacementPatches_(t,o,i,s),n(i,s)}return o}else p(1,t)},this.produceWithPatches=(t,r)=>{if(typeof t=="function")return(s,...a)=>this.produceWithPatches(s,c=>t(c,...a));let n,o;return[this.produce(t,r,(s,a)=>{n=s,o=a}),n,o]},typeof e?.autoFreeze=="boolean"&&this.setAutoFreeze(e.autoFreeze),typeof e?.useStrictShallowCopy=="boolean"&&this.setUseStrictShallowCopy(e.useStrictShallowCopy)}createDraft(e){C(e)||p(8),T(e)&&(e=Ue(e));let t=xe(this),r=re(e,void 0);return r[l].isManual_=!0,ee(t),r}finishDraft(e,t){let r=e&&e[l];(!r||!r.isManual_)&&p(9);let{scope_:n}=r;return me(n,t),_e(void 0,n)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}applyPatches(e,t){let r;for(r=t.length-1;r>=0;r--){let o=t[r];if(o.path.length===0&&o.op==="replace"){e=o.value;break}}r>-1&&(t=t.slice(r+1));let n=H("Patches").applyPatches_;return T(e)?n(e,t):this.produce(e,o=>n(o,t))}};function re(e,t){let r=$(e)?H("MapSet").proxyMap_(e,t):q(e)?H("MapSet").proxySet_(e,t):qe(e,t);return(t?t.scope_:be()).drafts_.push(r),r}function Ue(e){return T(e)||p(10,e),Te(e)}function Te(e){if(!C(e)||R(e))return e;let t=e[l],r;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,r=Y(e,t.scope_.immer_.useStrictShallowCopy_)}else r=Y(e,!0);return D(r,(n,o)=>{He(r,n,Te(o))}),t&&(t.finalized_=!1),r}var d=new Qe,Q=d.produce,wt=d.produceWithPatches.bind(d),St=d.setAutoFreeze.bind(d),It=d.setUseStrictShallowCopy.bind(d),Mt=d.applyPatches.bind(d),Bt=d.createDraft.bind(d),Ot=d.finishDraft.bind(d);function zt(e,t,r){let n=0,o=`${t}Q`;return Se(e,o).forEach(s=>{h(e,s).forEach(a=>{a===o&&(n+=1)})}),n===r.tileset.Q}function $t(e,t){return Se(e,`${t}Q`).every(n=>je(e,n,(o,i)=>i.length>0))}function qt(e,t,r){let n=g(e,t);return n?U(o=>{let i=_(t,o),s=h(e,i);return s.length>=n&&!se(e,t,o)?r(i,s,o):!0}):!0}function U(e){for(let t=1;t<=6;++t)if(e(t)==!1)return!1;return!0}function Rt(e,t,r){let n=g(e,t);return n?U(o=>{let i=_(t,o),s=h(e,i);return n-s.length>=2&&!se(e,t,o)?r(i,s,o):!0}):!0}function P(e,t,r){return U(n=>{let o=_(t,n);return r(o,h(e,o),n)!==!1})}function Pe(e,t,r){return U(n=>{let o=_(t,n),i=h(e,o);return i.length?r(o,i)!==!1:!0})}function we(e,t,r){let n=h(e,t),o=W(e,t),i=s=>fe(o,s);return n?P(e,t,(s,a,c)=>n.length-a.length===1&&!se(e,t,c)&&(n.length>1||We(e,s,i))?r(s,a,c):!0):!0}function b(e,t){for(let r in e)for(let n in e[r]){let o=e[r][n];if(t({q:+r,r:+n},o)===!1)return!1}return!0}function Qt(e,t){let r=new Set;return b(e,n=>P(e,n,(o,i)=>{let s=x(o);return!r.has(s)&&!i.length?(r.add(s),t(o,i)!==!1):!0}))}function je(e,t,r){return P(e,t,(n,o)=>r(n,o)===!0)}function Ut(e,t,r){let n;return P(e,t,(o,i)=>r(o,i)?(n=o,!1):!0),n}function Se(e,t){let r=[];return b(e,(n,o)=>{o.includes(t)&&r.push(n)}),r}function jt(e,t){let r={};return t=t??e.length,e.slice(0,t).forEach(n=>{E(n)||(F(n)&&ae(r,n.tileId,n.to),N(n)&&Be(r,n.from,n.to))}),r}function Kt(e,t,r){let n=0;return b(e,(o,i)=>{!t&&!r?n+=i.length:i.forEach(s=>{let a=t!==void 0?V(s)===t:!0,c=r!==void 0?pe(s)===r:!0;a&&c&&(n+=1)})}),n}function K(e){let t=[];return b(e,r=>t.push(r)),t}function W(e,t){let r=[];return Pe(e,t,n=>{r.push(n)}),r}function h(e,t){let{q:r,r:n}=t,o=e[r];return o?o[n]??[]:[]}function Wt(e,t){let r=[];return b(e,(n,o)=>r.push({coordinate:n,tiles:o})),t&&Ke(r),r}function g(e,t){return h(e,t).length}function ie(e,t){return h(e,t).at(-1)}function Vt(e){let t=[];return b(e,(r,n)=>t.push(...n)),t}function Ie(e){let t=[];return b(e,(r,n)=>t.push(...n)),t}function Jt(e){let t=new Set,r=[];return K(e).forEach(n=>{P(e,n,(o,i)=>{let s=x(o);!i.length&&!t.has(s)&&(t.add(s),r.push(o))})}),r}function Lt(e){return Object.keys(e).length===0}function se(e,t,r){let n=j(r-1),o=j(r+1),i=_(t,r),s=_(t,n),a=_(t,o),c=g(e,t),u=g(e,i),f=g(e,s),ce=g(e,a);return c<=f&&c<=ce&&u<f&&u<ce}function Xt(e,t){return h(e,t).length>0}function Me(e,t,r){return Q(e,n=>{Be(n,t,r)})}function Be(e,t,r){let n=ie(e,t);if(!n)throw new w(t);Oe(e,t),ae(e,n,r)}function Yt(e,t,r){return Q(e,n=>{ae(n,t,r)})}function ae(e,t,r){let{q:n,r:o}=r;n in e||(e[n]={}),o in e[n]||(e[n][o]=[]),e[n][o].push(t)}function Zt(e,t){return Q(e,r=>Oe(r,t))}function Oe(e,t){let{q:r,r:n}=t,o=e[r]?.[n]||[];if(!o.pop())throw new w(t);o.length===0&&delete e[r][n],Object.keys(e[r]).length===0&&delete e[r]}function Ke(e){return e.slice().sort((t,r)=>{let n=r.coordinate.r-t.coordinate.r;return n<0?1:n===0?t.tiles.length-r.tiles.length:-1})}function We(e,t,r){return!P(e,t,(n,o,i)=>!r(n,o,i))}function le(e,t,r){let n=new Set,o=[],i=a=>{n.add(x(a)),o.push(a),Pe(e,a,c=>{!G(r,c)&&!n.has(x(c))&&i(c)})};return h(e,t).length&&!G(t,r)&&i(t),o}function or(e,t){let r=[],n=new Set([x(t)]),o=(i,s)=>{we(i,s,a=>{console.log("slide dir",s);let c=x(a);if(!n.has(c)){if(!ie(i,s))throw new B(s);n.add(c),r.push(a),o(Me(i,s,a),a)}})};return o(e,t),r}function cr(e,t,r){let o=Ve(e,t,r).reduce((i,s)=>(i[s]=i[s]??[],i[s].push(s),i),{});return Object.values(o)}function Ve(e,t,r){let n=[],o={};Ie(e).forEach(s=>{o[s]=(o[s]||0)+1});let i;for(i in r.tileset){let s=de(t,i),a=r.tileset[i]||0,c=o[s]||0,u=Math.max(0,a-c),f=Array.from({length:u},()=>s);n.push(...f)}return n}function lr(e){return e.map(t=>E(t)?Le():F(t)?Xe(t.tileId,t.to):N(t)?Je(t.from,t.to):"").join()}function Je(e,t){return`(${e.q},${e.r})(${t.q},${t.r})`}function Le(){return"x"}function Xe(e,t){return`(${t.q},${t.r})[${e}]`}function dr(e){function t(s){if(s[0]==="("){let a=s.slice(1,-1).split(",");return{q:parseInt(a[0]),r:parseInt(a[1])}}if(s[0]==="[")return s.slice(1,-1);throw new Error(`Invalid token: ${s}`)}let r=[],n=[],o="",i="";for(let s=0,a=e.length;s<a;++s){let c=e[s];if(c==="#")break;if(c==="x"){r.push({pass:!0});continue}if(o+=c,i+=c,(c===")"||c==="]")&&(n.push(i),i=""),n.length===2){let u=t(n[0]),f=t(n[1]);typeof f=="string"?r.push({tileId:f,to:u}):r.push({from:u,to:f}),n=[],o=""}}return r}function mr(e,t,r){let n=[];for(let a=0;a<6;++a){let c=2*ue*a/6;n.push({x:e*Math.cos(c),y:e*Math.sin(c)})}if(t===0)return[Ge(n[5],r),...n.map(a=>Ee(a,r))].join(" ");let o=et(n,t/2),i=tt(o);return rt(i,r).join(" ")}function Ge(e,t){return`M${e.x.toFixed(t)} ${e.y.toFixed(t)}`}function Ee(e,t){return`L${e.x.toFixed(t)} ${e.y.toFixed(t)}`}function Ye(e,t,r){return`Q ${e.x.toFixed(r)} ${e.y.toFixed(r)}, ${t.x.toFixed(r)} ${t.y.toFixed(r)}`}function Ze(e,t){let r=e[0],n=e[1],o=n.x-r.x,i=n.y-r.y,s=Math.hypot(o,i);return[{x:r.x+t*o/s,y:r.y+t*i/s},{x:n.x-t*o/s,y:n.y-t*i/s}]}function et(e,t){let r=e.map((i,s)=>{let a=s===e.length-1?e[0]:e[s+1];return[i,...Ze([i,a],t)]}),n=r[0];return[r[r.length-1],...r,n]}function tt(e){let t=null,r=[];return e.forEach(([n,o,i])=>{t&&r.push([t,n,o]),t=i}),r}function rt(e,t){let r=[];return e.forEach(([n,o,i],s)=>{s===0?r.push(Ge(n,t)):r.push(Ee(n,t)),r.push(Ye(o,i,t))}),r}})();
